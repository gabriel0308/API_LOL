<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Melhor Jogador Global por Campeão - LoL</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #1a1a2e;
      color: #e6e6e6;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    h1 {
      color: #4e54c8;
      text-align: center;
    }
    .search-box {
      background: #0f3460;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .search-input-container {
      position: relative;
      margin-bottom: 15px;
    }
    .search-input {
      padding: 12px 15px 12px 40px;
      width: 100%;
      border-radius: 5px;
      border: 1px solid #4a4a6a;
      background: #1a1a2e;
      color: #e6e6e6;
      font-size: 1em;
    }
    .search-icon {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: #aaa;
    }
    .autocomplete-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      width: 100%;
      max-height: 300px;
      overflow-y: auto;
      background: #16213e;
      border: 1px solid #4a4a6a;
      border-top: none;
      border-radius: 0 0 5px 5px;
      z-index: 10;
      display: none;
    }
    .autocomplete-dropdown.show {
      display: block;
    }
    .autocomplete-item {
      padding: 10px 15px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 10px;
      transition: background 0.2s;
    }
    .autocomplete-item:hover {
      background: rgba(78, 84, 200, 0.3);
    }
    .autocomplete-item img {
      width: 30px;
      height: 30px;
      border-radius: 50%;
    }
    .autocomplete-item .champ-name {
      flex: 1;
    }
    .autocomplete-item .champ-title {
      font-size: 0.8em;
      color: #aaa;
    }
    button {
      padding: 12px 20px;
      border-radius: 5px;
      background: #4e54c8;
      color: white;
      border: none;
      cursor: pointer;
      font-size: 1em;
      width: 100%;
      transition: background 0.3s;
    }
    button:hover {
      background: #6a6fcb;
    }
    button:disabled {
      background: #4a4a6a;
      cursor: not-allowed;
    }
    .error {
      color: #ff6b6b;
      padding: 10px;
      background: rgba(255, 0, 0, 0.1);
      border-radius: 5px;
      margin-top: 10px;
    }
    .loading {
      text-align: center;
      padding: 20px;
      color: #4e54c8;
    }
    .player-info {
      background: #16213e;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .profile-header {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-bottom: 15px;
    }
    .profile-icon {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      border: 3px solid #4e54c8;
    }
    .profile-details {
      flex: 1;
    }
    .profile-name {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 5px;
      display: flex;
      align-items: center;
    }
    .region-tag {
      background: #4e54c8;
      color: white;
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 0.6em;
      margin-left: 10px;
    }
    .profile-rank {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .rank-icon {
      width: 40px;
      height: 40px;
    }
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    .stat-card {
      background: rgba(30, 30, 60, 0.5);
      padding: 15px;
      border-radius: 5px;
    }
    .stat-value {
      font-size: 1.2em;
      font-weight: bold;
      color: #4e54c8;
    }
    .matches-list {
      background: #16213e;
      border-radius: 8px;
      padding: 20px;
    }
    .match-item {
      background: rgba(30, 30, 60, 0.5);
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 10px;
    }
    .match-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      align-items: center;
    }
    .match-result {
      font-weight: bold;
      padding: 3px 10px;
      border-radius: 3px;
    }
    .match-result.win {
      background: rgba(76, 175, 80, 0.2);
      color: #4CAF50;
    }
    .match-result.loss {
      background: rgba(244, 67, 54, 0.2);
      color: #F44336;
    }
    .match-stats {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 10px;
    }
    .champion-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
    }
    .kda {
      font-weight: bold;
    }
    .positive {
      color: #4CAF50;
    }
    .negative {
      color: #F44336;
    }
    .current-region {
      margin-top: 5px;
      font-size: 0.9em;
      color: #aaa;
    }
    .current-region strong {
      color: #4e54c8;
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="container">
      <h1>Melhor Jogador Global por Campeão</h1>
      
      <div class="search-box">
        <div class="search-input-container">
          <i class="fas fa-search search-icon"></i>
          <input
            v-model="championName"
            class="search-input"
            placeholder="Digite o nome do campeão..."
            @input="filterChampions"
            @focus="showAutocomplete = true"
            @blur="setTimeout(() => { showAutocomplete = false }, 200)"
          >
          <div class="autocomplete-dropdown" :class="{ show: showAutocomplete && filteredChampions.length > 0 }">
            <div
              v-for="champ in filteredChampions"
              :key="champ.id"
              class="autocomplete-item"
              @mousedown="selectChampion(champ)"
            >
              <img
                :src="`https://ddragon.leagueoflegends.com/cdn/13.24.1/img/champion/${champ.image.full}`"
                :alt="champ.name"
              >
              <div class="champ-name">{{ champ.name }}</div>
              <div class="champ-title">{{ champ.title }}</div>
            </div>
          </div>
        </div>
        
        <button @click="searchBestPlayer" :disabled="loading || !championName">
          {{ loading ? 'Buscando...' : 'Buscar Melhor Jogador Global' }}
        </button>
        
        <div v-if="currentRegion" class="current-region">
          Analisando região: <strong>{{ currentRegion.toUpperCase() }}</strong>
        </div>
      </div>
      
      <div v-if="error" class="error">{{ error }}</div>
      
      <div v-if="loading" class="loading">
        <p>Buscando dados em todas as regiões...</p>
      </div>
      
      <div v-if="playerData" class="player-info">
        <div class="profile-header">
          <img
            :src="playerData.profile.profileIconUrl || 'https://ddragon.leagueoflegends.com/cdn/13.24.1/img/profileicon/0.png'"
            class="profile-icon"
            alt="Ícone do Jogador"
          >
          <div class="profile-details">
            <div class="profile-name">
              {{ playerData.name }}
              <span class="region-tag">{{ playerData.region.toUpperCase() }}</span>
            </div>
            <div class="profile-rank" v-if="playerData.profile.rank">
              <img
                :src="playerData.profile.rankImage || 'https://opgg-static.akamaized.net/images/medals/default.png'"
                class="rank-icon"
                alt="Rank"
              >
              <span>{{ playerData.profile.rank }} ({{ playerData.profile.leaguePoints }} LP)</span>
            </div>
            <div v-else>Sem rank</div>
          </div>
        </div>
        
        <h3>Estatísticas com {{ playerData.championName }}</h3>
        <div class="stats-grid">
          <div class="stat-card">
            <div>Winrate</div>
            <div class="stat-value">{{ playerData.stats.winrate }}%</div>
          </div>
          <div class="stat-card">
            <div>KDA</div>
            <div class="stat-value">{{ playerData.stats.kda.toFixed(2) }}</div>
          </div>
          <div class="stat-card">
            <div>Partidas</div>
            <div class="stat-value">{{ playerData.stats.totalMatches }}</div>
          </div>
          <div class="stat-card">
            <div>Kills/Partida</div>
            <div class="stat-value">{{ playerData.stats.avgKills.toFixed(1) }}</div>
          </div>
          <div class="stat-card">
            <div>Deaths/Partida</div>
            <div class="stat-value">{{ playerData.stats.avgDeaths.toFixed(1) }}</div>
          </div>
          <div class="stat-card">
            <div>Assists/Partida</div>
            <div class="stat-value">{{ playerData.stats.avgAssists.toFixed(1) }}</div>
          </div>
        </div>
      </div>
      
      <div v-if="matches.length > 0" class="matches-list">
        <h2>Histórico de Partidas Recentes</h2>
        <div v-for="(match, index) in matches" :key="index" class="match-item">
          <div class="match-header">
            <div>
              <img
                :src="`https://ddragon.leagueoflegends.com/cdn/13.24.1/img/champion/${match.championName}.png`"
                class="champion-icon"
                :alt="match.championName"
              >
              <span>{{ match.championName }}</span>
            </div>
            <div class="match-result" :class="match.win ? 'win' : 'loss'">
              {{ match.win ? 'VITÓRIA' : 'DERROTA' }}
            </div>
            <div>
              {{ new Date(match.gameCreation).toLocaleString() }}
            </div>
          </div>
          
          <div class="match-stats">
            <div>
              <div>KDA</div>
              <div class="kda" :class="getKdaClass(match.kda)">
                {{ match.kills }}/{{ match.deaths }}/{{ match.assists }}
                <span>({{ match.kda.toFixed(2) }})</span>
              </div>
            </div>
            <div>
              <div>Farm</div>
              <div>{{ match.totalMinionsKilled }} CS</div>
            </div>
            <div>
              <div>Visão</div>
              <div>{{ match.visionScore }}</div>
            </div>
            <div>
              <div>Dano</div>
              <div>{{ (match.totalDamageDealtToChampions / 1000).toFixed(1) }}k</div>
            </div>
            <div>
              <div>Dano a Objetivos</div>
              <div>{{ match.damageDealtToObjectives }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const { createApp, ref, onMounted } = Vue;
    
    createApp({
      setup() {
        // Dados reativos
        const championName = ref('');
        const loading = ref(false);
        const error = ref('');
        const playerData = ref(null);
        const matches = ref([]);
        const apiKey = ref('SUA_CHAVE_API_AQUI'); // Substitua pela sua chave
        const allChampions = ref([]);
        const filteredChampions = ref([]);
        const showAutocomplete = ref(false);
        const currentRegion = ref('');
        
        // Lista de regiões para buscar
        const regions = ['br1', 'na1', 'euw1', 'kr', 'jp1'];
        
        // Carregar lista de campeões ao iniciar
        onMounted(async () => {
          try {
            const response = await axios.get('https://ddragon.leagueoflegends.com/cdn/13.24.1/data/pt_BR/champion.json');
            const champions = Object.values(response.data.data);
            allChampions.value = champions;
            filteredChampions.value = champions.slice(0, 10); // Mostrar apenas os 10 primeiros inicialmente
          } catch (err) {
            console.error('Erro ao carregar lista de campeões:', err);
          }
        });
        
        // Filtrar campeões conforme digitação
        const filterChampions = () => {
          const searchTerm = championName.value.toLowerCase();
          if (searchTerm.length === 0) {
            filteredChampions.value = allChampions.value.slice(0, 10);
          } else {
            filteredChampions.value = allChampions.value.filter(champ => 
              champ.name.toLowerCase().includes(searchTerm) ||
              champ.id.toLowerCase().includes(searchTerm)
            ).slice(0, 10); // Limitar a 10 resultados
          }
        };
        
        // Selecionar um campeão do autocomplete
        const selectChampion = (champion) => {
          championName.value = champion.name;
          showAutocomplete.value = false;
        };
        
        // Buscar o melhor jogador global para o campeão
        const searchBestPlayer = async () => {
          if (!championName.value.trim()) {
            error.value = 'Por favor, selecione um campeão.';
            return;
          }
          
          try {
            loading.value = true;
            error.value = '';
            playerData.value = null;
            matches.value = [];
            
            let bestGlobalPlayer = null;
            let bestGlobalStats = null;
            let bestRegion = '';
            
            // Buscar em todas as regiões
            for (const region of regions) {
              currentRegion.value = region;
              
              try {
                // 1. Buscar a lista de challenger
                const leaderboardUrl = `https://${region}.api.riotgames.com/lol/league/v4/challengerleagues/by-queue/RANKED_SOLO_5x5?api_key=${apiKey.value}`;
                const leaderboardResponse = await axios.get(leaderboardUrl);
                const challengerPlayers = leaderboardResponse.data.entries;
                
                // Ordenar por LP
                challengerPlayers.sort((a, b) => b.leaguePoints - a.leaguePoints);
                
                // 2. Encontrar o melhor jogador com o campeão
                for (const player of challengerPlayers.slice(0, 20)) { // Verificar os top 20 de cada região
                  try {
                    const summonerUrl = `https://${region}.api.riotgames.com/lol/summoner/v4/summoners/${player.summonerId}?api_key=${apiKey.value}`;
                    const summonerResponse = await axios.get(summonerUrl);
                    const puuid = summonerResponse.data.puuid;
                    
                    // Determinar região para matches
                    const matchRegion = ['br1', 'na1'].includes(region) ? 'americas' :
                                       ['euw1'].includes(region) ? 'europe' :
                                       ['kr', 'jp1'].includes(region) ? 'asia' : 'americas';
                    
                    // Buscar partidas recentes
                    const matchesUrl = `https://${matchRegion}.api.riotgames.com/lol/match/v5/matches/by-puuid/${puuid}/ids?start=0&count=20&api_key=${apiKey.value}`;
                    const matchesResponse = await axios.get(matchesUrl);
                    const matchIds = matchesResponse.data;
                    
                    let championMatches = 0;
                    let wins = 0;
                    let kills = 0;
                    let deaths = 0;
                    let assists = 0;
                    let playerMatches = [];
                    
                    for (const matchId of matchIds) {
                      const matchUrl = `https://${matchRegion}.api.riotgames.com/lol/match/v5/matches/${matchId}?api_key=${apiKey.value}`;
                      const matchResponse = await axios.get(matchUrl);
                      const match = matchResponse.data;
                      
                      const participant = match.info.participants.find(p => p.puuid === puuid && 
                        p.championName.toLowerCase() === championName.value.toLowerCase());
                      
                      if (participant) {
                        championMatches++;
                        if (participant.win) wins++;
                        kills += participant.kills;
                        deaths += participant.deaths;
                        assists += participant.assists;
                        
                        playerMatches.push({
                          championName: participant.championName,
                          win: participant.win,
                          kills: participant.kills,
                          deaths: participant.deaths,
                          assists: participant.assists,
                          kda: (participant.kills + participant.assists) / Math.max(participant.deaths, 1),
                          totalMinionsKilled: participant.totalMinionsKilled,
                          visionScore: participant.visionScore,
                          totalDamageDealtToChampions: participant.totalDamageDealtToChampions,
                          damageDealtToObjectives: participant.damageDealtToObjectives,
                          gameCreation: match.info.gameCreation
                        });
                      }
                    }
                    
                    if (championMatches > 0) {
                      const winrate = (wins / championMatches) * 100;
                      const avgKills = kills / championMatches;
                      const avgDeaths = deaths / championMatches;
                      const avgAssists = assists / championMatches;
                      const kda = (kills + assists) / Math.max(deaths, 1);
                      
                      if (!bestGlobalPlayer || winrate > bestGlobalStats.winrate) {
                        bestGlobalPlayer = player;
                        bestGlobalStats = {
                          winrate,
                          kda,
                          avgKills,
                          avgDeaths,
                          avgAssists,
                          totalMatches: championMatches
                        };
                        bestRegion = region;
                        matches.value = playerMatches;
                      }
                    }
                  } catch (err) {
                    console.error(`Erro ao buscar dados do jogador ${player.summonerId}:`, err);
                  }
                }
              } catch (err) {
                console.error(`Erro ao buscar challenger na região ${region}:`, err);
              }
            }
            
            if (!bestGlobalPlayer) {
              error.value = `Nenhum jogador encontrado jogando com ${championName.value} no topo do challenger em nenhuma região.`;
              return;
            }
            
            // Obter detalhes do melhor jogador global
            const summonerUrl = `https://${bestRegion}.api.riotgames.com/lol/summoner/v4/summoners/${bestGlobalPlayer.summonerId}?api_key=${apiKey.value}`;
            const summonerResponse = await axios.get(summonerUrl);
            const summoner = summonerResponse.data;
            
            playerData.value = {
              name: summoner.name,
              region: bestRegion,
              championName: championName.value,
              profile: {
                profileIconUrl: `https://ddragon.leagueoflegends.com/cdn/13.24.1/img/profileicon/${summoner.profileIconId}.png`,
                rank: `${bestGlobalPlayer.tier} ${bestGlobalPlayer.rank}`,
                leaguePoints: bestGlobalPlayer.leaguePoints,
                rankImage: `https://opgg-static.akamaized.net/images/medals/${bestGlobalPlayer.tier.toLowerCase()}_${bestGlobalPlayer.rank.toLowerCase()}.png`
              },
              stats: bestGlobalStats
            };
            
          } catch (err) {
            handleError(err);
          } finally {
            loading.value = false;
            currentRegion.value = '';
          }
        };
        
        // Classificar KDA para cores
        const getKdaClass = (kda) => {
          if (kda >= 4) return 'positive';
          if (kda <= 2) return 'negative';
          return '';
        };
        
        // Tratamento de erros
        const handleError = (err) => {
          if (err.response) {
            if (err.response.status === 403) {
              error.value = 'Chave de API inválida ou expirada.';
            } else if (err.response.status === 429) {
              error.value = 'Muitas requisições. Aguarde um momento.';
            } else {
              error.value = `Erro na API: ${err.response.status}`;
            }
          } else {
            error.value = 'Erro ao conectar com o servidor.';
          }
          console.error(err);
        };
        
        return {
          championName,
          loading,
          error,
          playerData,
          matches,
          filteredChampions,
          showAutocomplete,
          currentRegion,
          searchBestPlayer,
          filterChampions,
          selectChampion,
          getKdaClass
        };
      }
    }).mount('#app');
  </script>
</body>
</html>